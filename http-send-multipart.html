<script type="text/x-red" data-template-name="http-send-multipart">
	<div class="form-row">
		<label for="node-input-method"><i class="fa fa-tasks"></i> <span data-i18n="http-send-multipart.label.method">Method</span></label>
		<select type="text" id="node-input-method" style="width:72%;">
        <option value="post">POST</option>
        <option value="put">PUT</option>
        </select>
	</div>
	<div class="form-row">
		<label for="node-input-url"><i class="fa fa-globe"></i> <span data-i18n="http-send-multipart.label.url">Url</span></label>
		<input type="text" id="node-input-url" placeholder="/url">
	</div>
	<div class="form-row">
		<label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name">Name</span></label>
		<input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
	</div>
	<div class="form-row">
		<input type="checkbox" id="node-input-useAuth" style="display: inline-block; width: auto; vertical-align: top;">
		<label for="node-input-useAuth" style="width: 70%;"><span data-i18n="httpin.basicauth"></span></label>
		<div style="margin-left: 20px" class="node-input-useAuth-row hide">
				<div class="form-row">
						<label for="node-input-user"><i class="fa fa-user"></i> <span data-i18n="common.label.username"></span></label>
						<input type="text" id="node-input-user">
				</div>
				<div class="form-row">
						<label for="node-input-password"><i class="fa fa-lock"></i> <span data-i18n="common.label.password"></span></label>
						<input type="password" id="node-input-password">
				</div>
		</div>
</div>
	<div id="node-input-tip" class="form-tips"><span data-i18n="http-send-multipart.tip.in"></span><code><span id="node-input-path"></span></code>.</div>
  <div id="node-output-tip" class="form-tips"><span data-i18n="http-send-multipart.tip.out"></span><code><span id="node-output-path"></span></code>.</div>
</script>

<script type="text/x-red" data-help-name="http-send-multipart">
	<p>Provides an output node for http POST requests that contain multi-part data, including files.</p>
	<p>The resulting message has the following properties:
		<ul>
			<li>msg.req : <a href="http://expressjs.com/api.html#req">http request</a></li>
			<li>msg.res : <a href="http://expressjs.com/api.html#res">http response</a></li>
		</ul>
	</p>

</script>


<script type="text/javascript">
	RED.nodes.registerType('http-send-multipart', {
		category: 'function',
		color: "rgb(231, 231, 174)",
		defaults: {
			name: {
				value: "",
				required: false
			},
			url: {
				value: "",
				required: true
			},
			method: {
				value: "POST",
				required: true
			}
		},
		credentials: {
			user: {type:"text"},
			password: {type: "password"}
		},
		inputs: 1,
		outputs: 1,
		icon: "white-globe.png",
		label: function() {
			if (this.name) {
				return this.name;
			} else {
				return "httpSendMultipart";
			}
		},
		labelStyle: function() {
			return this.name ? "node_label_italic" : "";
		},
		oneditprepare: function() {
			var root = RED.settings.httpNodeRoot;
			if (root.slice(-1) == "/") {
				root = root.slice(0, -1);
			}

			$("#node-input-useAuth").change(function() {
							if ($(this).is(":checked")) {
									$(".node-input-useAuth-row").show();
							} else {
									$(".node-input-useAuth-row").hide();
									$('#node-input-user').val('');
									$('#node-input-password').val('');
							}
					});
					if (this.credentials.user || this.credentials.has_password) {
							$('#node-input-useAuth').prop('checked', true);
					} else {
							$('#node-input-useAuth').prop('checked', false);
					}
					$("#node-input-useAuth").change();

					function updateTLSOptions() {
							if ($("#node-input-usetls").is(':checked')) {
									$("#node-row-tls").show();
							} else {
									$("#node-row-tls").hide();
							}
					}
					if (this.tls) {
							$('#node-input-usetls').prop('checked', true);
					} else {
							$('#node-input-usetls').prop('checked', false);
					}
					updateTLSOptions();
					$("#node-input-usetls").on("click",function() {
							updateTLSOptions();
					});
					$("#node-input-ret").change(function() {
							if ($("#node-input-ret").val() === "obj") {
									$("#tip-json").show();
							} else {
									$("#tip-json").hide();
							}
					});


			$("#node-input-path").html(root);
			$("#node-input-tip").show();
			$("#node-output-tip").show();

			if (!RED.nodes.getType("swagger-doc")) {
				$('.row-swagger-doc').hide();
			}
		}

	});
</script>
